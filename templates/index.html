<!DOCTYPE html>
<html lang="en">
<head>
    <title>DefaulterInsight | Prediction</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
    <style>
        body {
            font-family: Lato, sans-serif;
            background-color: #f8f9fa;
        }

        .project-name {
            font-size: 1.9rem;
            font-weight: bold;
            background: linear-gradient(90deg, #003366, #00BFFF);
            -webkit-background-clip: text;
            color: transparent;
        }

        .title {
            color: #273582;
        }

        .result-box {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            min-height: 200px;
            overflow-y: auto;
        }

        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #273582;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.2s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin: -30px 0 0 -30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loading {
            display: none;
            position: fixed;
            z-index: 9999;
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.7);
            top: 0;
            left: 0;
        }

        .footer {
            background-color: #e3e8ed;
            padding: 1rem 0;
            position: relative;
        }

        footer a {
            color: #000;
            font-weight: 600;
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-light bg-light static-top">
    <div class="container-fluid text-center">
        <a class="navbar-brand project-name" href="#">
            <img src="updatedlogo.webp" alt="DefaulterInsight Logo" style="height: 80px; width: 80px;">
            DefaulterInsight
        </a>
    </div>
</nav>

<!-- Main Section -->
<section class="text-center mt-4">
    <div class="container-fluid">
        <h4 class="title mb-4">Prediction</h4>
        <div class="row">
            <!-- Form Input -->
            <div class="col-md-6 col-sm-12 mb-4">
                <form id="datafetch_form">
                    <div class="form-group">
                        <input type="text" name="csvfile" id="csvfile" class="form-control"
                               placeholder="Enter absolute file path (e.g. /home/user/input.csv)" required>
                    </div>
                    <button class="btn btn-primary btn-block" id="customfile">Custom File Predict</button>
                    <p class="my-3 font-weight-bold">OR</p>
                    <button class="btn btn-primary btn-block" id="defaultfile" data-path="Prediction_Batch_files">Default File Predict</button>
                </form>
            </div>

            <!-- Result Display -->
            <div class="col-md-6 col-sm-12">
                <div class="result-box shadow-sm">
                    <h6 class="title text-left mb-2">Results</h6>
                    <div class="json-result text-left"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="footer text-center">
    <div class="container">
        <ul class="list-inline mb-1">
            <li class="list-inline-item"><a href="#">About</a></li>
            <li class="list-inline-item">&sdot;</li>
            <li class="list-inline-item"><a href="#">Contact</a></li>
            <li class="list-inline-item">&sdot;</li>
            <li class="list-inline-item"><a href="#">Privacy Policy</a></li>
        </ul>
        <p class="text-muted small mb-0">&copy; 2025 DefaulterInsight. All Rights Reserved.</p>
    </div>
</footer>

<!-- Loader -->
<div id="loading"><div class="loader"></div></div>

<!-- Scripts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#loading').hide();

        $('#customfile').click(function (e) {
            e.preventDefault();
            let path = $('#csvfile').val().trim();
            if (!path) return alert("Please enter a file path.");
            $('#loading').show();
            $.ajax({
                url: "/predict",
                method: "POST",
                data: { filepath: path },
                success: function (response) {
                    $(".json-result").html('<p><strong>Prediction File created at:</strong> <code>Prediction_Output_File/Predictions.csv</code></p><pre>' + response + '</pre>');
                    $('#loading').hide();
                },
                error: function () {
                    $(".json-result").html('<p class="text-danger">❌ Error occurred during prediction.</p>');
                    $('#loading').hide();
                }
            });
        });

        $('#defaultfile').click(function (e) {
            e.preventDefault();
            let path = $(this).data("path");
            $('#loading').show();
            $.ajax({
                url: "/predict",
                method: "POST",
                data: { filepath: path },
                success: function (response) {
                    $(".json-result").html('<p><strong>Prediction File created at:</strong> <code>Prediction_Output_File/Predictions.csv</code></p><pre>' + response + '</pre>');
                    $('#loading').hide();
                },
                error: function () {
                    $(".json-result").html('<p class="text-danger">❌ Error occurred during prediction.</p>');
                    $('#loading').hide();
                }
            });
        });
    });
</script>
</body>
</html>
